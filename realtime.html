<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UMBC GPS Campus Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
	  .home-button {
	  position: absolute;
	  top: 10px;
	  right: 10px;
	  background-color: #007BFF;
	  color: white;
	  padding: 10px 15px;
	  border: none;
	  border-radius: 5px;
	  font-size: 16px;
	  cursor: pointer;
	  text-decoration: none;
	  z-index: 1000;
	}
	.home-button:hover {
	  background-color: #0056b3;
	}

    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
      height: 100vh;
    }
  </style>
</head>
<body>

<div id="map"></div>
<a href="home_page.html" class="home-button">Back to Home</a>

<script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // Initialize the map centered around UMBC (approx)
  var map = L.map('map', {
  center: [39.2557, -76.7110],
  zoom: 17,
  maxZoom: 22, // allows deeper zoom-in
  minZoom: 14  // prevents zooming too far out
});

  // Load OpenStreetMap tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors',
	maxZoom: 22 // Need to match this to the new max zoom
  }).addTo(map);



  // Entrance coordinates
  var entrancePoints = {
	"University Center entrance 1": [39.254121, -76.713030], "University Center entrance 2": [39.254396, -76.713047], "University Center entrance 3": [39.254639, -76.713211],
	"University Center entrance 4": [39.254391, -76.713456], "University Center entrance 5": [39.254041, -76.713235],
	
	"Sherman Hall entrance 1": [39.253584, -76.713079], "Sherman Hall entrance 2": [39.253334, -76.713227], "Sherman Hall entrance 3": [39.253395, -76.713423], 
	"Sherman Hall entrance 4": [39.253458, -76.713656], "Sherman Hall entrance 5": [39.253514, -76.713852], "Sherman Hall entrance 6": [39.253958, -76.713639], 
	
	"Performing Arts & Humanities entrance 1": [39.255138, -76.714628], "Performing Arts & Humanities entrance 2": [39.255248, -76.714782],
	"Retrivers Activities Center(RAC) entrance 1": [39.252382, -76.712750],  "Retrivers Activities Center(RAC) entrance 2": [39.253113, -76.712750],
	
	"Administration Building entrance 1": [39.252947, -76.713367], "Administration Building entrance 2": [39.253068, -76.713313], "Administration Building entrance 3": [39.252917, -76.712948],
	
	"Sondheim Hall entrance 1": [39.253270, -76.713018], "Sondheim Hall entrance 2": [39.253702, -76.712822], "Sondheim Hall entrance 3":[39.253732, -76.712656], "Sondheim Hall entrance 3": [39.253202, -76.712916],
	
	"Math and Psychology Building entrance 1": [39.253896, -76.712670], "Math and Psychology Building entrance 1": [39.254349, -76.712460],
	
	"Information Technology Engineering Building entrance 1": [39.253964, -76.713831], "Information Technology Engineering Building entrance 2": [39.253730, -76.713941], 
	"Information Technology Engineering Building entrance 3": [39.253557, -76.714417], "Information Technology Engineering Building entrance 4": [39.254148, -76.714205],
	"Information Technology Engineering Building entrance 5": [39.254194, -76.714472],
	
	"Engineering Building entrance 1": [39.254478, -76.713619], "Engineering Building entrance 2": [39.254389, -76.713664], "Engineering Building entrance 3": [39.254185, -76.713919],
	"Engineering Building entrance 4": [39.254281, -76.714179], "Engineering Building entrance 5": [39.254565, -76.714319], "Engineering Building entrance 6": [39.254672, -76.714273],
	"Engineering Building entrance 7": [39.254781, -76.713888],
	
	"Meyerhoff Building entrance 1": [39.254659, -76.712594], "Meyerhoff Building entrance 2": [39.254786, -76.713206], "Meyerhoff Building entrance 3": [39.255247, -76.712991],
	"Meyerhoff Building entrance 4": [39.255061, -76.712416], "Meyerhoff Building entrance 5": [39.254824, -76.712452],
	
	"Fine Arts Building entrance 1": [39.255212, -76.713242], "Fine Arts Building entrance 2": [39.254923, -76.713373], "Fine Arts Building entrance 3": [39.254879, -76.713700],
	"Fine Arts Building entrance 4": [39.255461, -76.713920], "Fine Arts Building entrance 5": [39.255406, -76.713452], "Fine Arts Building entrance 6": [39.255092, -76.714089],

	//yafet additions
	"Public Policy Building entrance 1": [39.255104, -76.709295], "Public Policy Entrance 2": [39.255096, -76.709167], "Public Policy Entrance 3": [39.255206, -76.709489], "Public Policy Entrance 4": [39.255315, -76.709117],
	
	"The Commons entrance 1": [39.255112, -76.711583], "The Commons entrance 2": [39.254936, -76.711069], "The Commons entrance 3": [39.255186, -76.710902], "The Commons entrance 4": [39.255114, -76.710629], 
	"The Commons entrance 5": [39.254424, -76.711037], "The Commons entrance 6": [39.254469, -76.711180],
	
	"Physics Building entrance 1": [39.254243, -76.709884], "Physics Building entrance 2": [39.254742, -76.709687], "Physics Building entrance 3": [39.254651, -76.709247], "Physics Building entrance 4": [39.254609, -76.709257],
	
	"Susquehanna Hall entrance 1": [39.255535, -76.708554], "Susquehanna Hall entrance 2": [39.255605, -76.708357], "Susquehanna Hall entrance 3": [39.256096, -76.708282], "Susquehanna Hall entrance 4": [39.255811, -76.709247],
	
	"The Center For Well-Being entrance 1": [39.256135, -76.709095], 
	
	"Chesapeake Hall entrance 1": [39.256325, -76.708854], "Chesapeake Hall entrance 2": [39.256806, -76.708770], "Chesapeake Hall entrance 3": [39.256639, -76.708210], "Chesapeake Hall entrance 4": [39.256652, -76.708596], 
	"Chesapeake Hall entrance 5": [39.256875, -76.708595], "Chesapeake Hall entrance 6": [39.256736, -76.707987],
	
	"True Grit's Dining Hall entrance 1": [39.255556, -76.707863],
	
	"Patapsco Hall entrance 1": [39.255066, -76.707247], "Patapsco Hall entrance 2": [39.255200, -76.707525], "Patapsco Hall entrance 3": [39.255293, -76.707124], "Patapsco Hall entrance 4": [39.255072, -76.706373],
	"Patapsco Hall entrance 5": [39.254917, -76.706362], "Patapsco Hall entrance 6": [39.255657, -76.707026], 
	
	"Potomac Hall entrance 1": [39.255959, -76.706744],
	
	"Harbor Hall entrance 1": [39.257115, -76.708345], "Harbor Hall entrance 2": [39.257461, -76.708429], "Harbor Hall entrance 3": [39.257528, -76.707907],
	"Harbor Hall entrance 4": [39.257176, -76.707608], 
	
	"Erickson Hall entrance 1": [39.256642, -76.709401], "Erickson Hall entrance 2": [39.256780, -76.710036], "Erickson Hall entrance 3": [39.256833, -76.710221], "Erickson Hall entrance 4": [39.257010, -76.709798],
	
  //Daniel additions
  "Greenhouse Entrance": [39.258353, -76.713557], 
  "Albin O. Kuhn Library & Gallery": [39.256294, -76.711528],
  "Deep Creek Entrance": [39.257684, -76.708874],
  "Elk Entrance": [39.257862, -76.709539],
  "Breton Entrance": [39.258105, -76.708568],
  "Casselman": [39.257987, -76.709204],
  "Sideling": [39.258446, -76.708654],
  "Manokin Entrance": [39.258668, -76.709082],
  "Pocomoke": [39.258350, -76.709279],
  "Patuxent": [39.258169, -76.709480],
  "Wicomico": [39.257919, -76.709735],
  "Antietam": [39.257742, -76.710013],
  "Sassafras": [39.258028, -76.710084],
  "Chincoteague": [39.257611, -76.710333],
  "Tuckahoe": [39.257697, -76.710955],
  "Gunpowder": [39.257756, -76.711158],
  "Monocacy": [39.258048, -76.710924],
  "Nanticoke": [39.257866, -76.711517],
  "Central Plant": [39.257597, -76.713747],
  "Choptank 1": [39.258919, -76.713129], "Choptank 2": [39.258708, -76.712963],
  "Magothy 1": [39.259152, -76.712619], "Magothy 2": [39.258939, -76.712457],
  "Tangier 1": [39.259016, -76.712924], "Tangier 2": [39.258800, -76.712760],
  "Wye 1": [39.258617, -76.712662], "Wye 2": [39.258747, -76.712389],
  "Chester 1": [39.258803, -76.711881], "Chester 2": [39.258936, -76.711602],
  "Apartment Community Center": [39.258237, -76.712050],
  "Walker Avenue Apartments I 1": [39.259458, -76.714054], "Walker Avenue Apartments I 2 ":[39.259400, -76.714122], "Walker Avenue Apartments I 3 ":[39.259674, -76.713816], "Walker Avenue Apartments I 4 ":[39.259547, -76.713509], "Walker Avenue Apartments I 5 ":[39.259432, -76.713601],
  "Walker Avenue Apartments II 1": [39.258872, -76.714339], "Walker Avenue Apartments II 2": [39.258990, -76.714673], "Walker Avenue Apartments II 3": [39.258856, -76.714793],
  "Walker Avenue Apartments III": [39.258576, -76.715179],
  "Baltimore County Court House": [39.260138, -76.715109],
  "ROTC House": [39.258917, -76.717140],
  "Recreation House": [39.258538, -76.717236],
  "Baltimore County Police": [39.259789, -76.716407],
  "Alumni House": [39.258282, -76.717763]


  };

  // Dictionary to store invisible markers for future toggling
  var entranceMarkers = {};

  // Layer group to manage entrance markers
  var entranceLayer = L.layerGroup().addTo(map);

  // Add invisible markers to map
  Object.entries(entrancePoints).forEach(([name, coord]) => {
    var marker = L.circleMarker(coord, {
      radius: 5,
      color: 'blue',
      fillColor: 'blue',
      fillOpacity: 1,
      opacity: 0,          // invisible
      interactive: false   // not clickable
    }).addTo(entranceLayer);

    entranceMarkers[name] = marker; // Save reference
  });

  // === Map Click Logger ===
  map.on('click', function(e) {
    var lat = e.latlng.lat.toFixed(6);
    var lng = e.latlng.lng.toFixed(6);
    alert(`Clicked at: [${lat}, ${lng}]`);
  });

  
	let sidewalkData;
	fetch('umbc_sidewalks.geojson')
	  .then(res => res.json())
	  .then(data => {
		sidewalkData = data;
		L.geoJSON(data, {
		  style: {
			color: 'green',
			weight: 3,
			opacity: 0.7
		  }
		}).addTo(map);
		
		connectEntrancesToSidewalks();
	  });
	  
	fetch('umbc_steps.geojson')
	  .then(res => res.json())
	  .then(data => {
		L.geoJSON(data, {
		  style: {
			color: 'purple',
			weight: 3,
			dashArray: '4',
			opacity: 0.7
		  }
		}).addTo(map);
	  });
	  
	function connectEntrancesToSidewalks() {
	  Object.entries(entrancePoints).forEach(([name, coord]) => {
		const entrancePoint = turf.point([coord[1], coord[0]]); // GeoJSON format is [lng, lat]

		let closestPoint = null;
		let minDist = Infinity;

		sidewalkData.features.forEach(feature => {
		  if (feature.geometry.type === "LineString") {
			const snapped = turf.nearestPointOnLine(feature, entrancePoint);
			const dist = turf.distance(entrancePoint, snapped);
			if (dist < minDist) {
			  minDist = dist;
			  closestPoint = snapped;
			}
		  }
		});

		if (closestPoint) {
		  const snappedLatLng = [closestPoint.geometry.coordinates[1], closestPoint.geometry.coordinates[0]];
		  
		  // Optional: draw a line from entrance to the snapped point
		  L.polyline([coord, snappedLatLng], {
			color: 'blue',
			weight: 2,
			dashArray: '5,5',
			opacity: 0.5
		  }).addTo(map);
		}
	  });
	}


  // === Example: Show a marker when selected as destination ===
  // entranceMarkers["Library Entrance"].setStyle({ opacity: 1, fillOpacity: 0.9 });

</script>
</body>
</html>
